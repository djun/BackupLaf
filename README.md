# BackupLaf 是一个备份Laf和迁移Laf的工具

当前版本仅开发了备份和迁移数据库的功能，也仅兼容1.0的版本，0.8迁移到1.0的版本稍晚推出

## 数据库备份和迁移

适用于1.0之间数据库的备份和迁移

### 1、备份数据库云函数 `BackupDB`

`BackupDB` 是备份全部数据的云函数，需要在需要备份数据的Laf中运行，备份到目标迁移的Laf的存储桶中。`/BackupDB/` 下的按照集合名称去保存

#### `BackupDB`云函数需要修改的参数

`bucket` 请替换为你的存储桶名称，填目标迁移laf的存储桶名称，打开读写权限

`credentialsURL` 请替换为你的目标迁移laf的获取云存储保存的临时密钥的函数地址

### 2、恢复数据库云函数 `ReductionDB`

`ReductionDB`需要在目标迁移的Laf中运行，是将存储桶`/BackupDB/` 下的全部Json插入到目标迁移Laf的数据库中

#### `ReductionDB`云函数需要修改的参数

`bucket` 请替换为你的存储桶名称，填目标迁移laf的存储桶名称，打开读写权限

`bucketURL` 请替换为目标迁移laf的oss域名，域名格式如：`oss.laf.run`，如果不知道是什么可以上传一个文件到存储桶，就可以看到了

### 3、获取云存储上传临时密钥云函数 `get-oss-sts`

`get-oss-sts`发布到目标迁移的Laf中

### 4、注意事项

`BackupDB` 和 `ReductionDB` 云函数在备份/恢复过程中，如果数据较多，所需时间会较长。会出现网关超时的情况，不用理会，Laf后台会继续执行，Laf云函数的运行稳得一逼！！判断执行成功的方法，可以去日志查看`全部数据库恢复完成`或`全部数据库备份完成`的字样，判断是否成功

如果出现失败，请不要慌，直接再次运行备份/恢复云函数即可，本项目会将备份/恢复记录保存到集合名：`BackupDB` 和 `ReductionDB` 中，从而实现断点备份和断点恢复

## 云函数迁移

适用于1.0之间的云函数迁移

### 1、迁移云函数 `FuncMigrate`

替换相应的参数，点击运行即可，可以不用发布。云函数的迁移非常快。

### 2、注意事项

如果新老应用有相同云函数，相同的云函数会迁移失败，可以先把新应用同样名称的云函数删除后重新尝试
